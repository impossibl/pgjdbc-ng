dist: xenial
language: java
services:
  - docker
env:
  - PGVERSION=9.4
  - PGVERSION=9.5
  - PGVERSION=9.6
  - PGVERSION=10
  - PGVERSION=11
jdk:
  - openjdk8
  - openjdk9
  - openjdk10
  - openjdk11
before_install:
  - \[ $TRAVIS_JDK_VERSION = 'openjdk8' ] && _JAVA_OPTIONS="$_JAVA_OPTIONS -Djdk.net.URLClassPath.disableClassPathURLCheck=true" || _JAVA_OPTIONS="$_JAVA_OPTIONS"
  # PostgreSQL requires specific permissions... this meets the requirements
  # when running via docker in Travis
  - chmod 0400 ./driver/src/test/resources/certdir/server/server.key
  - sudo chown 70:70 ./driver/src/test/resources/certdir/server/server.key
  - ./start-test-container.sh
script: mvn -e test -DtrimStackTrace=false
after_failure:
  - ./.travis/print_surefire_reports
after_success:
  - "test $TRAVIS_PULL_REQUEST == 'false' && test $TRAVIS_BRANCH == 'develop' && test $TRAVIS_JDK_VERSION == 'openjdk8' && test $PGVERSION == '10' && ./.travis/travis-maven-deploy"
cache:
  directories:
    - '$HOME/.m2/repository'
